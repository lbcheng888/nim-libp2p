# Android mDNS + DM + Feed + Livestream Demo

This module hosts a Compose/NDK powered mobile MVP that exercises the `libnimlibp2p`
FFI. The app bundles the following features:

- mDNS interface enumeration with IPv4/IPv6 lane endpoints
- LAN peer discovery with inline connect + chat affordances
- Direct messaging with acknowledgement tracking
- Content feed publishing and snapshot rendering
- Simple decentralized livestream publisher that emits raw text frames

## Production baseline

For the current “production delivery” hardening baseline (safe defaults + runtime-configurable connectivity), see `examples/android/PRODUCTION.md`.

## Prerequisites

1. Build the shared Nim runtime and copy the native dependencies:

   ```bash
   # From the repository root
   ./examples/build_nim_android.sh
   ```

   The script expects `ANDROID_NDK_HOME` plus the prebuilt OpenSSL artifacts
   (`build/openssl-android/android-arm64`). Successful execution produces:

   ```
   examples/android/app/src/main/jniLibs/arm64-v8a/libnimlibp2p.so
   examples/android/app/src/main/jniLibs/arm64-v8a/libssl.so
   examples/android/app/src/main/jniLibs/arm64-v8a/libcrypto.so
   examples/android/app/src/main/jniLibs/arm64-v8a/libc++_shared.so
   ```

2. Build the bridge shared object (`libnimbridge.so` is generated by Gradle
   via `CMakeLists.txt`) during the regular app build.

3. Android Studio Iguana (AGP 8.10+) or `gradlew` with JDK 17+. The module
   targets arm64-v8a devices (minSdk 24).

## Running

1. Open `examples/android` in Android Studio or run:

   ```bash
   ./gradlew :app:assembleDebug
   ```

2. Deploy to an arm64 emulator/handset. The app will automatically start the
   libp2p node, enable mDNS and begin polling the FFI event queue.

3. Use multiple devices/emulators on the same network to observe peer
   discovery, DM delivery, feed propagation and livestream frame emission.

### Native Bridge Highlights

- `app/src/main/cpp/nim_bridge.cpp` exposes JNI wrappers for the exported Nim
  symbols and forwards `nim_bridge_emit_event` into Android logcat.
- `NimLibp2p` (`app/src/main/java/.../native/NimBridge.kt`) manages shared
  library loading and provides Kotlin-friendly wrappers.
- `NimNodeViewModel` drives the background event loop, state reduction and
  orchestration of direct message, feed and livestream flows.

### UI Overview

- **Overview** tab lists IPv4/IPv6 addresses and discovered peers.
- **Chat** tab lets you select a peer, inspect conversation history and send
  JSON-wrapped direct messages with ack status.
- **Feed** tab publishes timeline entries and renders inbound `ContentFeedItem`
  events.
- **Live** tab simulates livestream frames (text payload) while logging frame
  ACK events.

Refer to `examples/libnimlibp2p.nim` for the authoritative FFI contract when
adding new features or tuning protocol behaviour.
